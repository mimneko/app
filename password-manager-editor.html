<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>パスワード管理</title>
    <script type="application/json" id="password-data">
    {
        "accounts": [
            {
                "account": "Amazon",
                "registrationDate": "2023-01-15",
                "status": "現役",
                "target": "個人",
                "username": "taro_yamada",
                "email": "taro.yamada@example.com",
                "password": "AmzSecure!2023",
                "customData": [
                    {"label": "プライム会員", "value": "有効", "id": "cd1a2b3c"},
                    {"label": "配送先", "value": "自宅", "id": "cd4d5e6f"}
                ],
                "lastName": "山田",
                "firstName": "太郎",
                "birthdate": "1990-05-20",
                "gender": "男性",
                "phone": "090-1234-5678",
                "postalCode": "160-0023",
                "country": "日本",
                "prefecture": "東京都",
                "address": "新宿区西新宿2-8-1",
                "notes": [
                    {"date": "2023-01-15", "content": "アカウント作成", "visible": true},
                    {"date": "2023-05-10", "content": "パスワード変更", "visible": true}
                ],
                "id": "a1b2c3d4"
            },
            {
                "account": "楽天",
                "registrationDate": "2022-12-01",
                "status": "現役",
                "target": "個人",
                "username": "yamada_taro",
                "email": "yamada.taro@rakuten.com",
                "password": "Rktn!2022Secure",
                "customData": [
                    {"label": "ポイント会員", "value": "ゴールド", "id": "cd7g8h9i"}
                ],
                "lastName": "山田",
                "firstName": "太郎",
                "birthdate": "1990-05-20",
                "gender": "男性",
                "phone": "090-1234-5678",
                "postalCode": "160-0023",
                "country": "日本",
                "prefecture": "東京都",
                "address": "新宿区西新宿2-8-1",
                "notes": [
                    {"date": "2022-12-01", "content": "アカウント作成", "visible": false},
                    {"date": "2023-04-15", "content": "ポイント更新", "visible": true}
                ],
                "id": "m3n4o5p6"
            },
            {
                "account": "Google",
                "registrationDate": "2022-11-20",
                "status": "現役",
                "target": "家族",
                "username": "hanako.family",
                "email": "hanako.family@gmail.com",
                "password": "GglFamily!2022",
                "customData": [],
                "lastName": "山田",
                "firstName": "花子",
                "birthdate": "1985-08-15",
                "gender": "女性",
                "phone": "090-8765-4321",
                "postalCode": "160-0023",
                "country": "日本",
                "prefecture": "東京都",
                "address": "新宿区西新宿2-8-1",
                "notes": [
                    {"date": "2022-11-20", "content": "家族用アカウント作成", "visible": false},
                    {"date": "2023-03-15", "content": "セキュリティ設定確認", "visible": true},
                    {"date": "2023-07-01", "content": "二段階認証設定", "visible": true}
                ],
                "id": "e5f6g7h8"
            },
            {
                "account": "Twitter",
                "registrationDate": "2021-06-10",
                "status": "退会",
                "target": "個人",
                "username": "taro_tweet",
                "email": "taro.tweet@example.com",
                "password": "TwtrSecure!2021",
                "customData": [],
                "lastName": "山田",
                "firstName": "太郎",
                "birthdate": "1990-05-20",
                "gender": "男性",
                "phone": "090-1234-5678",
                "postalCode": "160-0023",
                "country": "日本",
                "prefecture": "東京都",
                "address": "新宿区西新宿2-8-1",
                "notes": [
                    {"date": "2021-06-10", "content": "アカウント作成", "visible": false},
                    {"date": "2022-12-05", "content": "アカウント休止", "visible": true}
                ],
                "id": "i9j0k1l2"
            },
            {
                "account": "Google",
                "registrationDate": "2022-11-20",
                "status": "現役",
                "target": "家族",
                "username": "hanako.family",
                "email": "hanako.family@gmail.com",
                "password": "GglSecure!2022",
                "customData": [
                    {"label": "ストレージプラン", "value": "100GB", "id": "cd0j1k2l"},
                    {"label": "バックアップ", "value": "有効", "id": "cd3m4n5o"}
                ],
                "lastName": "山田",
                "firstName": "花子",
                "birthdate": "1985-08-15",
                "gender": "女性",
                "phone": "090-8765-4321",
                "postalCode": "160-0023",
                "country": "日本",
                "prefecture": "東京都",
                "address": "新宿区西新宿2-8-1",
                "notes": [
                    {"date": "2022-11-20", "content": "家族用アカウント作成", "visible": false},
                    {"date": "2023-03-15", "content": "セキュリティ設定確認", "visible": true},
                    {"date": "2023-07-01", "content": "二段階認証設定", "visible": false}
                ],
                "id": "q7r8s9t0"
            }
        ]
    }
    </script>
    <style>
        /* 全体のスタイル */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Yu Gothic Medium", "Hiragino Sans", "Meiryo", "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            padding-top: 120px;
        }

        button {
            color: white;
        }
        
        /* フィルター部分 */
        .filters {
            background-color: #fff;
            padding: 15px;
            border-radius: 0 0 5px 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex-grow: 1;
        }
        
        .filter-group label {
            font-weight: bold;
            font-size: 0.9rem;
            color: #666;
        }
        
        .filters input, .filters select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .reset-btn {
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 15px;
            cursor: pointer;
            font-weight: bold;
            align-self: flex-end;
            transition: background-color 0.2s;
        }
        
        .reset-btn:hover {
            background-color: #d32f2f;
        }
        
        /* カード表示（共通） */
        .card-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px;
        }
        
        /* 大画面向けカード表示 */
        @media (min-width: 1200px) {
            .card-container {
                grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            }
        }
        
        /* 小さい画面向けカード表示 */
        @media (max-width: 768px) {
            .card-container {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
                padding: 10px;
            }
            
            .filter-group {
                width: 100%;
            }
            
            body {
                padding-top: 210px;
            }

            .filter-group:has(> #filter-status),
            .filter-group:has(> #filter-target),
            .filter-group:has(> #filter-email),
            #reset-filters {
                display: none;
            }
        }
        
        .card {
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .card-header {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .service-name {
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .card-header-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .registration-date {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .card-content {
            padding: 15px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px 15px;
        }
        
        .card-group {
            margin-bottom: 10px;
        }
        
        .card-group.full-width {
            grid-column: 1 / -1;
        }
        
        .card-label {
            font-weight: bold;
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
            display: block;
        }
        
        .card-value {
            padding: 8px;
            background-color: #f9f9f9;
            border-radius: 4px;
            word-break: break-all;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .card-value:hover {
            background-color: #f0f7ff;
        }
        
        .card-value.copied {
            background-color: #e3f2fd;
        }
        
        .notes-container {
            grid-column: 1 / -1;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }
        
        .note-item {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #eee;
        }
        
        .note-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .note-date {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 3px;
        }
        
        /* 編集用備考スタイル */
        .edit-note-item {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            background-color: #f9f9f9;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .edit-note-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .edit-note-item input.edit-note-date {
            width: 150px;
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        .edit-note-item textarea.edit-note-content {
            width: 100%;
            field-sizing: content;
            min-height: 40px;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            resize: vertical;
        }
        .edit-note-item button {
            margin-right: 5px;
            align-self: flex-end;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
        }
        
        /* 編集用カスタムデータスタイル */
        .edit-custom-data-item {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            background-color: #f9f9f9;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .edit-custom-data-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .edit-custom-data-item input.edit-custom-data-label,
        .edit-custom-data-item input.edit-custom-data-value {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        .edit-custom-data-item button {
            margin-right: 5px;
            align-self: flex-end;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
            white-space: nowrap; /* Prevents text from wrapping */
        }
        
        /* コピー通知 */
        .copy-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #333;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }
        
        .copy-notification.show {
            opacity: 1;
        }
        
        /* 検索結果と並び替え */
        .result-count {
            color: #666;
            font-size: 0.9rem;
            text-align: right;
        }
        
        .sort-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .sort-controls span {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* 詳細情報表示 */
        .card-content > details {
            grid-column: 1 / -1;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }
        
        details summary {
            cursor: pointer;
            font-weight: bold;
            color: #2c3e50;
            padding: 5px 0;
            transition: color 0.2s;
        }
        
        details summary:hover {
            color: #1a252f;
        }
        
        .details-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px 15px;
            margin-top: 10px;
            padding: 0;
            border-radius: 4px;
        }
        
        .details-content .card-group.full-width {
            grid-column: 1 / -1;
        }

        /* アクションボタン */
        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .btn-add {
            background-color: #4caf50;
        }
        
        .btn-add:hover {
            background-color: #3e8e41;
        }
        
        .btn-export {
            background-color: #2196f3!important;
        }
        
        .btn-export:hover {
            background-color: #0b7dda!important;
        }
        
        .btn-edit {
            background-color: #ff9800;
        }
        
        .btn-edit:hover {
            background-color: #e68900;
        }
        
        .btn-delete {
            background-color: #f44336;
        }
        
        .btn-delete:hover {
            background-color: #d32f2f;
        }
        
        /* アカウント追加モーダル */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 0;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 80%;
            max-width: 800px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
            background-color: #fff;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .modal-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .close-modal {
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            color: #666;
        }
        
        .close-modal:hover {
            color: #000;
        }
        
        .form-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            padding: 20px;
            overflow-y: auto;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        .form-group label {
            font-weight: bold;
            font-size: 0.9rem;
            color: #666;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            font-family: "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Yu Gothic Medium", "Hiragino Sans", "Meiryo", "Helvetica Neue", Arial, sans-serif;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .submit-btn {
            grid-column: 1 / -1;
            background-color: #ff9800;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 15px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 10px;
        }
        
        .submit-btn:hover {
            background-color: #e68900;
        }
        
        /* 新規追加・編集モーダルの個人情報欄を2列レイアウトにする */
        .personal-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        #edit-details-personal,
        #new-details-personal,
        .personal-info-grid .form-group.full-width {
            grid-column: 1 / -1;
        }

        .hidden-note-indicator {
            font-size: small;
            text-align: right;
        }

        .delete-note-btn {
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 15px;
            margin-left: auto;
            cursor: pointer;
            font-weight: bold;
            align-self: flex-end;
            transition: background-color 0.2s;
        }
        
        .delete-note-btn:hover {
            background-color: #d32f2f;
        }
        
        /* Toggle Switch for Edit Notes */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
            margin: 0 10px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-switch .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .toggle-switch .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        .toggle-switch input:checked + .slider {
            background-color: #2196F3;
        }
        .toggle-switch input:focus + .slider {
            box-shadow: 0 0 1px #2196F3;
        }
        .toggle-switch input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .highlighted {
            background-color: #ff9800!important;
            border-color: #ff9800!important;
        }

        #edit-custom-data-group,
        #edit-notes-group {
            padding: 15px 0;
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
        }

        #new-custom-data-group,
        #new-details-personal {
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        @media print {
            .filters,
            .withdrawn-account,
            .edit-btn,
            details,
            .hidden-note-indicator,
            .btn-edit {
                display: none;
            }

            body {
                background-color: transparent;
                padding: 0;
            }

            .card-header {
                background-color: transparent;
                color: #000;
                border-bottom: 1px solid #000;
            }

            .card {
                background-color: transparent;
                border: 2px solid #000;
                box-shadow: none;
            }

            .card-value {
                background-color: transparent;
                border: 1px solid #000;
            }

            .notes-container {
                border-top: 1px solid #000;
            }

            .note-item {
                padding-bottom: 0;
                border-bottom: none;
            }
        }
    </style>
</head>
<body>
    <section class="filters">
        <div class="filter-group">
            <label for="search-account">サービス検索</label>
            <input type="text" id="search-account" placeholder="サービス名を入力">
        </div>
        
        <div class="filter-group">
            <label for="filter-status">状況</label>
            <select id="filter-status">
                <option value="退会以外" selected>退会以外</option>
                <option value="すべて">すべて</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label for="filter-target">名義</label>
            <select id="filter-target">
                <option value="">すべて</option>
                <!-- 名義オプションはJSで動的に追加 -->
            </select>
        </div>
        
        <div class="filter-group">
            <label for="filter-email">メールアドレス</label>
            <select id="filter-email">
                <option value="">すべて</option>
                <!-- メールアドレスオプションはJSで動的に追加 -->
            </select>
        </div>
        
        <div class="filter-group">
            <span class="result-count" id="result-count"></span>
            <button class="reset-btn btn-delete" id="reset-filters">リセット</button>
        </div>
        
        <div class="filter-group">
            <button id="add-account" class="action-btn btn-add">アカウント追加</button>
            <button id="export-json" class="action-btn btn-export">JSONエクスポート</button>
        </div>
    </section>

    <!-- カード表示 -->
    <div class="card-container" id="card-container">
        <!-- JSで動的に追加 -->
    </div>
    
    <!-- アカウント追加モーダル -->
    <div id="add-account-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">新しいアカウントを追加</h3>
                <span class="close-modal" id="close-add-modal">&times;</span>
            </div>
            <form id="add-account-form" class="form-container">
                <div class="form-group full-width">
                    <label for="new-account">サービス名*</label>
                    <input type="text" id="new-account" required placeholder="Amazon, Google など">
                </div>
                <div class="form-group">
                    <label for="new-status">状況*</label>
                    <select id="new-status" required>
                        <option value="現役">現役</option>
                        <option value="放置">放置</option>
                        <option value="退会">退会</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="new-target">名義*</label>
                    <input type="text" id="new-target" required placeholder="個人、家族 など" list="target-options">
                    <datalist id="target-options"></datalist>
                </div>
                <div class="form-group">
                    <label for="new-username">ユーザー（アカウント）名</label>
                    <input type="text" id="new-username" placeholder="user123 など">
                </div>
                <div class="form-group">
                    <label for="new-email">メールアドレス</label>
                    <input type="email" id="new-email" placeholder="example@email.com" list="email-options">
                    <datalist id="email-options"></datalist>
                </div>
                <div class="form-group">
                    <label for="new-password">パスワード</label>
                    <input type="text" id="new-password" placeholder="パスワード">
                </div>
                <div class="form-group full-width" id="new-custom-data-group">
                    <div id="new-custom-data-container"></div>
                    <button type="button" id="add-new-custom-data" class="action-btn btn-add">カスタムデータ追加</button>
                </div>
                <details id="new-details-personal">
                    <summary>個人情報</summary>
                    <div class="personal-info-grid">
                        <div class="form-group">
                            <label for="new-lastname">姓LastName</label>
                            <input type="text" id="new-lastname" placeholder="山田">
                        </div>
                        <div class="form-group">
                            <label for="new-firstname">名FirstName</label>
                            <input type="text" id="new-firstname" placeholder="太郎">
                        </div>
                        <div class="form-group">
                            <label for="new-birthdate">生年月日</label>
                            <input type="date" id="new-birthdate">
                        </div>
                        <div class="form-group">
                            <label for="new-gender">性別</label>
                            <select id="new-gender">
                                <option value="">選択なし</option>
                                <option value="男性">男性</option>
                                <option value="女性">女性</option>
                                <option value="その他">その他</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="new-phone">電話番号</label>
                            <input type="tel" id="new-phone" placeholder="090-1234-5678">
                        </div>
                        <div class="form-group">
                            <label for="new-postalcode">郵便番号</label>
                            <input type="text" id="new-postalcode" placeholder="123-4567">
                        </div>
                        <div class="form-group">
                            <label for="new-country">国</label>
                            <input type="text" id="new-country" placeholder="日本">
                        </div>
                        <div class="form-group">
                            <label for="new-prefecture">都道府県</label>
                            <input type="text" id="new-prefecture" placeholder="東京都">
                        </div>
                        <div class="form-group full-width">
                            <label for="new-address">住所</label>
                            <input type="text" id="new-address" placeholder="新宿区西新宿1-1-1">
                        </div>
                    </div>
                </details>
                <div class="form-group full-width">
                    <button type="button" id="fill-default-personal-add" class="submit-btn btn-export">固定個人情報入力</button>
                </div>
                <div class="form-group full-width">
                    <label for="new-note">備考</label>
                    <textarea id="new-note" placeholder="備考を入力してください"></textarea>
                </div>
                <button type="submit" class="submit-btn">アカウントを追加</button>
            </form>
        </div>
    </div>
    
    <!-- アカウント編集モーダル -->
    <div id="edit-account-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">アカウント編集</h3>
                <span class="close-modal" id="close-edit-modal">&times;</span>
            </div>
            <form id="edit-account-form" class="form-container">
                <div class="form-group full-width">
                    <label for="edit-account">サービス名*</label>
                    <input type="text" id="edit-account" required placeholder="Amazon, Google など">
                </div>
                <div class="form-group">
                    <label for="edit-status">状況*</label>
                    <select id="edit-status" required>
                        <option value="現役">現役</option>
                        <option value="放置">放置</option>
                        <option value="退会">退会</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-target">名義*</label>
                    <input type="text" id="edit-target" required placeholder="個人、家族 など" list="target-options">
                </div>
                <div class="form-group">
                    <label for="edit-username">ユーザー（アカウント）名</label>
                    <input type="text" id="edit-username" placeholder="user123 など">
                </div>
                <div class="form-group">
                    <label for="edit-email">メールアドレス</label>
                    <input type="email" id="edit-email" placeholder="example@email.com" list="email-options">
                </div>
                <div class="form-group">
                    <label for="edit-password">パスワード</label>
                    <input type="text" id="edit-password" placeholder="パスワード">
                </div>
                <div class="form-group full-width" id="edit-custom-data-group">
                    <div id="edit-custom-data-container"></div>
                    <button type="button" id="add-edit-custom-data" class="action-btn btn-add">カスタムデータ追加</button>
                </div>
                <details id="edit-details-personal">
                    <summary>個人情報</summary>
                    <div class="personal-info-grid">
                        <div class="form-group">
                            <label for="edit-lastname">姓LastName</label>
                            <input type="text" id="edit-lastname" placeholder="山田">
                        </div>
                        <div class="form-group">
                            <label for="edit-firstname">名FirstName</label>
                            <input type="text" id="edit-firstname" placeholder="太郎">
                        </div>
                        <div class="form-group">
                            <label for="edit-birthdate">生年月日</label>
                            <input type="date" id="edit-birthdate">
                        </div>
                        <div class="form-group">
                            <label for="edit-gender">性別</label>
                            <select id="edit-gender">
                                <option value="">選択なし</option>
                                <option value="男性">男性</option>
                                <option value="女性">女性</option>
                                <option value="その他">その他</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-phone">電話番号</label>
                            <input type="tel" id="edit-phone" placeholder="090-1234-5678">
                        </div>
                        <div class="form-group">
                            <label for="edit-postalcode">郵便番号</label>
                            <input type="text" id="edit-postalcode" placeholder="123-4567">
                        </div>
                        <div class="form-group">
                            <label for="edit-country">国</label>
                            <input type="text" id="edit-country" placeholder="日本">
                        </div>
                        <div class="form-group">
                            <label for="edit-prefecture">都道府県</label>
                            <input type="text" id="edit-prefecture" placeholder="東京都">
                        </div>
                        <div class="form-group full-width">
                            <label for="edit-address">住所</label>
                            <input type="text" id="edit-address" placeholder="新宿区西新宿1-1-1">
                        </div>
                    </div>
                </details>
                <!-- 備考編集エリア：複数のノートを表示し、各ノートはトグルスイッチで表示/非表示を切り替え可能 -->
                <div class="form-group full-width" id="edit-notes-group">
                    <div id="edit-notes-container"></div>
                    <button type="button" id="add-edit-note" class="action-btn btn-add">備考を追加</button>
                </div>
                <button type="submit" class="submit-btn">アカウントを更新</button>
            </form>
        </div>
    </div>
    
    <div class="copy-notification" id="copy-notification">
        クリップボードにコピーしました
    </div>
    <script>
        // データ読み込み: HTMLからパスワードデータを取得し、JSONとして解析
        const passwordData = JSON.parse(document.getElementById('password-data').textContent);
        let accounts = passwordData.accounts;

        // 個人情報の日本語ラベルマッピング
        const personalInfoLabels = {
            lastName: '姓LastName',
            firstName: '名FirstName',
            birthdate: '生年月日',
            gender: '性別',
            phone: '電話番号',
            postalCode: '郵便番号',
            country: '国',
            prefecture: '都道府県'
        };

        // DOM要素の参照: 各種HTML要素を取得してオブジェクトに格納
        const domElements = {
            cardContainer: document.getElementById('card-container'),
            searchAccount: document.getElementById('search-account'),
            filterStatus: document.getElementById('filter-status'),
            filterTarget: document.getElementById('filter-target'),
            filterEmail: document.getElementById('filter-email'),
            copyNotification: document.getElementById('copy-notification'),
            resetFiltersBtn: document.getElementById('reset-filters'),
            resultCount: document.getElementById('result-count')
        };

        // フィルターオプションの初期設定: フィルターの選択肢を設定
        function setupFilterOptions() {
            const targetFreq = calculateFrequency(accounts, 'target');
            const emailFreq = calculateFrequency(accounts, 'email');
            
            updateFilterOptions(domElements.filterTarget, targetFreq);
            updateFilterOptions(domElements.filterEmail, emailFreq);
            updateDatalist('target-options', targetFreq);
            updateDatalist('email-options', emailFreq);
        }

        // 頻度計算: 指定されたキーに基づいてデータの頻度を計算
        function calculateFrequency(data, key) {
            return data.reduce((acc, item) => {
                const value = item[key] || "";
                if (value) acc[value] = (acc[value] || 0) + 1;
                return acc;
            }, {});
        }

        // フィルターオプションの更新: フィルター要素にオプションを追加
        function updateFilterOptions(filterElement, frequencyData) {
            const sortedKeys = Object.keys(frequencyData).sort((a, b) => frequencyData[b] - frequencyData[a]);
            filterElement.innerHTML = '<option value="">すべて</option>';
            sortedKeys.forEach(key => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = key;
                filterElement.appendChild(option);
            });
        }

        // データリストの更新: データリストにオプションを追加
        function updateDatalist(datalistId, frequencyData) {
            const datalist = document.getElementById(datalistId);
            if (datalist) {
                datalist.innerHTML = '';
                Object.keys(frequencyData).forEach(key => {
                    const opt = document.createElement('option');
                    opt.value = key;
                    datalist.appendChild(opt);
                });
            }
        }
        
        // データ表示（カード）: アカウントデータをカード形式で表示
        function renderData(data) {
            domElements.cardContainer.innerHTML = '';
            domElements.resultCount.textContent = `検索結果: ${data.length}/${accounts.length} 件`;
            
            data.forEach(account => {
                const card = createCard(account);
                domElements.cardContainer.appendChild(card);
            });
        }

        // カード作成: アカウント情報を基にカードを生成
        function createCard(account) {
            const card = document.createElement('div');
            card.className = 'card';
            card.classList.add(getStatusClass(account.status));

            const header = createCardHeader(account);
            card.appendChild(header);

            const content = createCardContent(account);
            card.appendChild(content);

            return card;
        }

        // ステータスクラス取得: アカウントの状況に応じたクラス名を返す
        function getStatusClass(status) {
            const statusClasses = {
                '現役': 'active-account',
                '放置': 'inactive-account',
                '退会': 'withdrawn-account'
            };
            return statusClasses[status] || 'unknown-account';
        }

        // カードヘッダー作成: カードのヘッダー部分を生成
        function createCardHeader(account) {
            const header = document.createElement('div');
            header.className = 'card-header';

            const serviceName = document.createElement('h2');
            serviceName.className = 'service-name';
            serviceName.textContent = account.account;
            header.appendChild(serviceName);

            const headerInfo = document.createElement('div');
            headerInfo.className = 'card-header-info';

            const registrationDate = document.createElement('span');
            registrationDate.className = 'registration-date';
            registrationDate.textContent = account.registrationDate || '記録なし';
            headerInfo.appendChild(registrationDate);

            header.appendChild(headerInfo);

            const editBtn = document.createElement('button');
            editBtn.className = 'action-btn btn-edit';
            editBtn.textContent = '編集';
            editBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                openEditModal(account);
            });
            header.appendChild(editBtn);

            return header;
        }

        // カードコンテンツ作成: カードのコンテンツ部分を生成
        function createCardContent(account) {
            const content = document.createElement('div');
            content.className = 'card-content';

            addNonCopyableCardItem(content, '状況', account.status);
            addNonCopyableCardItem(content, '名義', account.target);
            addCardItem(content, 'メールアドレス', account.email);
            addCardItem(content, 'パスワード', account.password);
            addCardItem(content, 'ユーザー（アカウント）名', account.username);

            if (account.customData && account.customData.length > 0) {
                account.customData.forEach(data => {
                    addCardItem(content, data.label, data.value);
                });
            }

            if (hasPersonalInfo(account)) {
                const details = createDetails(account);
                content.appendChild(details);
            }

            const notesContainer = createNotesContainer(account.notes);
            if (notesContainer) {
                content.appendChild(notesContainer);
            }

            return content;
        }

        // 個人情報の有無を確認: アカウントに個人情報が含まれているかを確認
        function hasPersonalInfo(account) {
            return ['lastName', 'firstName', 'birthdate', 'gender', 'phone', 'postalCode', 'country', 'prefecture', 'address']
                .some(key => account[key]);
        }

        // 詳細情報作成: 個人情報の詳細を生成
        function createDetails(account) {
            const details = document.createElement('details');
            const summary = document.createElement('summary');
            summary.textContent = '個人情報';
            details.appendChild(summary);

            const detailsContent = document.createElement('div');
            detailsContent.className = 'details-content';

            // 日本語ラベルで表示
            ['lastName', 'firstName', 'birthdate', 'gender', 'phone', 'postalCode', 'country', 'prefecture'].forEach(key => {
                addCardItem(detailsContent, personalInfoLabels[key] || key, account[key]);
            });

            const addressGroup = createAddressGroup(account.address);
            detailsContent.appendChild(addressGroup);

            details.appendChild(detailsContent);
            return details;
        }

        // 住所グループ作成: 住所情報を表示するグループを生成
        function createAddressGroup(address) {
            const addressGroup = document.createElement('div');
            addressGroup.className = 'card-group full-width';

            const addressLabel = document.createElement('div');
            addressLabel.className = 'card-label';
            addressLabel.textContent = '住所';

            const addressValue = document.createElement('div');
            addressValue.className = 'card-value';
            addressValue.textContent = address || '';
            addressValue.addEventListener('click', (e) => handleCopy(e, address || ''));

            addressGroup.appendChild(addressLabel);
            addressGroup.appendChild(addressValue);
            return addressGroup;
        }

        // 備考コンテナ作成: 備考を表示するコンテナを生成
        function createNotesContainer(notes) {
            if (!notes || notes.length === 0) {
                return null;
            }

            const notesContainer = document.createElement('div');
            notesContainer.className = 'notes-container';

            const notesLabel = document.createElement('div');
            notesLabel.className = 'card-label';
            notesContainer.appendChild(notesLabel);

            const visibleNotes = notes.filter(note => note.visible !== false);
            const hiddenNotes = notes.filter(note => note.visible === false);

            if (visibleNotes.length > 0) {
                const sortedNotes = [...visibleNotes].sort((a, b) => new Date(a.date) - new Date(b.date));
                sortedNotes.forEach(note => {
                    const noteItem = createNoteItem(note);
                    notesContainer.appendChild(noteItem);
                });
            }

            if (hiddenNotes.length > 0) {
                const hiddenNoteIndicator = document.createElement('div');
                hiddenNoteIndicator.className = 'hidden-note-indicator';
                hiddenNoteIndicator.textContent = `非表示の備考: ${hiddenNotes.length} 件`;
                notesContainer.appendChild(hiddenNoteIndicator);
            }

            return notesContainer;
        }

        // 備考項目作成: 備考の個別項目を生成
        function createNoteItem(note) {
            const noteItem = document.createElement('div');
            noteItem.className = 'note-item';

            const dateDiv = document.createElement('div');
            dateDiv.className = 'note-date';
            dateDiv.textContent = note.date;

            const contentDiv = document.createElement('div');
            contentDiv.className = 'card-value';
            contentDiv.textContent = note.content;
            contentDiv.addEventListener('click', (e) => handleCopy(e, note.content));

            noteItem.appendChild(dateDiv);
            noteItem.appendChild(contentDiv);
            return noteItem;
        }
        
        // カード項目作成ヘルパー: カード内の項目を生成
        function addCardItem(container, label, value) {
            if (!value) return;
            const group = document.createElement('div');
            group.className = 'card-group';
            
            const labelElement = document.createElement('div');
            labelElement.className = 'card-label';
            labelElement.textContent = label;
            
            const valueElement = document.createElement('div');
            valueElement.className = 'card-value';
            valueElement.textContent = value;
            valueElement.addEventListener('click', (e) => handleCopy(e, value));
            
            group.appendChild(labelElement);
            group.appendChild(valueElement);
            container.appendChild(group);
        }

        // 非コピー可能なカード項目作成ヘルパー: コピー不可の項目を生成
        function addNonCopyableCardItem(container, label, value) {
            if (!value) return;
            const group = document.createElement('div');
            group.className = 'card-group';
            
            const labelElement = document.createElement('div');
            labelElement.className = 'card-label';
            labelElement.textContent = `${label}：${value}`;
            
            group.appendChild(labelElement);
            container.appendChild(group);
        }
        
        // クリップボードにコピーとUI表示: テキストをクリップボードにコピーし、通知を表示
        function handleCopy(event, text) {
            if (!text) return;
            
            const element = event.currentTarget;
            element.classList.add('copied');
            setTimeout(() => {
                element.classList.remove('copied');
            }, 1000);
            
            navigator.clipboard.writeText(text)
                .then(() => {
                    domElements.copyNotification.textContent = `「${text.substring(0, 20)}${text.length > 20 ? '...' : ''}」をコピーしました`;
                    domElements.copyNotification.classList.add('show');
                    setTimeout(() => {
                        domElements.copyNotification.classList.remove('show');
                    }, 2000);
                })
                .catch(err => {
                    console.error('クリップボードのコピーに失敗しました:', err);
                });
        }
        
        // 編集用備考項目を生成する関数: 編集可能な備考項目を生成
        function populateEditNotes(notes) {
            const container = document.getElementById('edit-notes-container');
            container.innerHTML = '';
            if (!notes || notes.length === 0) {
                notes = [];
            }
            notes.forEach(note => {
                const noteItem = createEditNoteItem(note, container);
                container.appendChild(noteItem);
            });
        }

        // 編集用備考項目作成: 編集可能な備考の個別項目を生成
        function createEditNoteItem(note, container) {
            const noteItem = document.createElement('div');
            noteItem.className = 'edit-note-item';
            noteItem.setAttribute('data-visible', (note.visible === false ? "false" : "true"));
            
            const controls = createEditNoteControls(note, container, noteItem);
            noteItem.appendChild(controls);
            
            const contentTextarea = document.createElement('textarea');
            contentTextarea.className = 'edit-note-content';
            contentTextarea.placeholder = '備考を入力してください';
            contentTextarea.value = note.content || '';

            noteItem.appendChild(contentTextarea);
            return noteItem;
        }

        // 編集用備考コントロール作成: 備考の編集コントロールを生成
        function createEditNoteControls(note, container, noteItem) {
            const controls = document.createElement('div');
            controls.className = 'edit-note-controls';
            
            const dateInput = document.createElement('input');
            dateInput.type = 'date';
            dateInput.className = 'edit-note-date';
            dateInput.value = note.date || new Date().toISOString().split('T')[0];
            
            const toggleLabel = document.createElement('label');
            toggleLabel.className = 'toggle-switch';
            const toggleInput = document.createElement('input');
            toggleInput.type = 'checkbox';
            toggleInput.checked = note.visible !== false;
            toggleInput.addEventListener('change', function() {
                noteItem.setAttribute('data-visible', toggleInput.checked ? "true" : "false");
            });
            const toggleSlider = document.createElement('span');
            toggleSlider.className = 'slider';
            toggleLabel.appendChild(toggleInput);
            toggleLabel.appendChild(toggleSlider);
                        
            controls.appendChild(dateInput);
            controls.appendChild(toggleLabel);

            
            if (note.isNew) {
                const deleteBtn = document.createElement('button');
                deleteBtn.type = 'button';
                deleteBtn.className = 'delete-note-btn btn-delete';
                deleteBtn.textContent = '削除';
                deleteBtn.addEventListener('click', function() {
                    container.removeChild(noteItem);
                });
                controls.appendChild(deleteBtn);
            }
            
            return controls;
        }
        
        // 編集用カスタムデータ項目を生成する関数: 編集可能なカスタムデータ項目を生成
        function populateEditCustomData(customData) {
            const container = document.getElementById('edit-custom-data-container');
            container.innerHTML = '';
            if (!customData || customData.length === 0) {
                customData = [];
            }
            customData.forEach(data => {
                const dataItem = createEditCustomDataItem(data, container);
                container.appendChild(dataItem);
            });
        }

        // 編集用カスタムデータ項目作成: 編集可能なカスタムデータの個別項目を生成
        function createEditCustomDataItem(data, container) {
            const dataItem = document.createElement('div');
            dataItem.className = 'edit-custom-data-item';
            
            const labelInput = document.createElement('input');
            labelInput.type = 'text';
            labelInput.className = 'edit-custom-data-label';
            labelInput.placeholder = 'ラベル名を入力';
            labelInput.value = data.label || '';
            labelInput.setAttribute('list', 'custom-label-options');

            const valueInput = document.createElement('input');
            valueInput.type = 'text';
            valueInput.className = 'edit-custom-data-value';
            valueInput.placeholder = '値を入力';
            valueInput.value = data.value || '';

            const controls = createEditCustomDataControls(data, container, dataItem, labelInput, valueInput);
            dataItem.appendChild(controls);
            
            return dataItem;
        }

        // 編集用カスタムデータコントロール作成: カスタムデータの編集コントロールを生成
        function createEditCustomDataControls(data, container, dataItem, labelInput, valueInput) {
            const controls = document.createElement('div');
            controls.className = 'edit-custom-data-controls';

            controls.appendChild(labelInput);
            controls.appendChild(valueInput);

            if (data.isNew) {
                const deleteBtn = document.createElement('button');
                deleteBtn.type = 'button';
                deleteBtn.className = 'action-btn btn-delete';
                deleteBtn.textContent = '削除';
                deleteBtn.addEventListener('click', function() {
                    container.removeChild(dataItem);
                });
                controls.appendChild(deleteBtn);
            }

            return controls;
        }
        
        // フィルタリング処理: アカウントデータをフィルタリング
        function filterData() {
            const accountQuery = domElements.searchAccount.value.toLowerCase();
            const statusQuery = domElements.filterStatus.value;
            const targetQuery = domElements.filterTarget.value;
            const emailQuery = domElements.filterEmail.value;
            
            const filteredData = accounts.filter(account => {
                const accountMatch = account.account.toLowerCase().includes(accountQuery);
                const statusMatch = (statusQuery === "すべて") || (statusQuery === "退会以外" && account.status !== "退会");
                const targetMatch = !targetQuery || account.target === targetQuery;
                const emailMatch = !emailQuery || account.email === emailQuery;
                
                return accountMatch && statusMatch && targetMatch && emailMatch;
            });
            
            renderData(filteredData);
        }
        
        // フィルターリセット: フィルターを初期状態に戻す
        function resetFilters() {
            domElements.searchAccount.value = '';
            domElements.filterStatus.value = '退会以外';
            domElements.filterTarget.value = '';
            domElements.filterEmail.value = '';
            filterData();
        }
                
        // アカウント追加・編集・JSONエクスポート機能: アカウント管理機能の設定
        function setupAccountManagement() {
            const addAccountBtn = document.getElementById('add-account');
            const exportJsonBtn = document.getElementById('export-json');
            const addAccountModal = document.getElementById('add-account-modal');
            const closeAddModalBtn = document.getElementById('close-add-modal');
            const addAccountForm = document.getElementById('add-account-form');
            
            const editAccountModal = document.getElementById('edit-account-modal');
            const closeEditModalBtn = document.getElementById('close-edit-modal');
            const editAccountForm = document.getElementById('edit-account-form');
            let currentEditingAccountId = null;
            
            addAccountBtn.addEventListener('click', () => {
                if (accounts.length >= 1024) {
                    showNotification('アカウントの上限に達しました。');
                    return;
                }
                addAccountModal.style.display = 'block';
                trackChanges('new');
                
                // 新しいアカウントのデフォルト値として最も頻繁に使用される名義を設定
                const targetOptions = document.getElementById('target-options').options;
                if (targetOptions.length > 0) {
                    document.getElementById('new-target').value = targetOptions[0].value;
                }
            });
            
            closeAddModalBtn.addEventListener('click', () => {
                handleModalClose('new', addAccountModal);
            });
            
            closeEditModalBtn.addEventListener('click', () => {
                handleModalClose('edit', editAccountModal);
            });

            window.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    if (addAccountModal.style.display === 'block') {
                        handleModalClose('new', addAccountModal);
                    }
                    if (editAccountModal.style.display === 'block') {
                        handleModalClose('edit', editAccountModal);
                    }
                }
            });
            
            window.addEventListener('click', (e) => {
                if (e.target === addAccountModal) {
                    handleModalClose('new', addAccountModal);
                }
                if (e.target === editAccountModal) {
                    handleModalClose('edit', editAccountModal);
                }
            });
            
            addAccountForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const newAccount = createNewAccount();
                accounts.push(newAccount);
                addAccountForm.reset();
                addAccountModal.style.display = 'none';
                setupFilterOptions();
                filterData();
                showNotification(`新しいアカウントを追加しました: ${newAccount.account}`);
                resetFormStyles('new');
            });
            
            function openEditModal(account) {
                currentEditingAccountId = account.id;
                populateEditForm(account);
                editAccountModal.style.display = 'block';
                trackChanges('edit');
            }
            
            window.openEditModal = openEditModal;
            
            editAccountForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const account = accounts.find(acc => acc.id === currentEditingAccountId);
                if (account) {
                    const changes = updateAccount(account);
                    if (changes.length > 0) {
                        const today = new Date().toISOString().split('T')[0];
                        changes.forEach(change => {
                            account.notes.push({
                                date: today,
                                content: change,
                                visible: false
                            });
                        });
                    }
                }
                editAccountModal.style.display = 'none';
                setupFilterOptions();
                filterData();
                showNotification(`アカウントを更新しました: ${account.account}`);
                resetFormStyles('edit');
            });

            // アカウント更新: アカウント情報を更新し、変更内容を記録
            function updateAccount(account) {
                const changes = [];
                const fields = [
                    { id: 'edit-account', key: 'account', label: 'サービス名' },
                    { id: 'edit-status', key: 'status', label: '状況' },
                    { id: 'edit-target', key: 'target', label: '名義' },
                    { id: 'edit-email', key: 'email', label: 'メールアドレス' },
                    { id: 'edit-password', key: 'password', label: 'パスワード' },
                    { id: 'edit-username', key: 'username', label: 'ユーザー（アカウント）名' },
                    { id: 'edit-birthdate', key: 'birthdate', label: '生年月日' },
                    { id: 'edit-gender', key: 'gender', label: '性別' },
                    { id: 'edit-lastname', key: 'lastName', label: '姓LastName' },
                    { id: 'edit-firstname', key: 'firstName', label: '名FirstName' },
                    { id: 'edit-prefecture', key: 'prefecture', label: '都道府県' },
                    { id: 'edit-country', key: 'country', label: '国' },
                    { id: 'edit-phone', key: 'phone', label: '電話番号' },
                    { id: 'edit-postalcode', key: 'postalCode', label: '郵便番号' },
                    { id: 'edit-address', key: 'address', label: '住所' }
                ];

                const changeDetails = [];
                fields.forEach(field => {
                    const newValue = document.getElementById(field.id).value;
                    if (account[field.key] !== newValue) {
                        changeDetails.push(`${field.label}を「${account[field.key]}」から「${newValue}」に`);
                        account[field.key] = newValue;
                    }
                });
                if (changeDetails.length > 0) {
                    changes.push(`${changeDetails.join('、')}変更しました`);
                }

                account.notes = updateNotes();
                account.customData = updateCustomData(account, changes);

                return changes;
            }

            // 備考更新: 備考情報を更新
            function updateNotes() {
                const notesContainer = document.getElementById('edit-notes-container');
                const noteItems = notesContainer.getElementsByClassName('edit-note-item');
                let newNotes = [];
                for (const item of noteItems) {
                    if (newNotes.length >= 64) {
                        showNotification('備考の上限に達しました。');
                        break;
                    }
                    const dateVal = item.querySelector('.edit-note-date').value;
                    const contentVal = item.querySelector('.edit-note-content').value;
                    const visibleVal = item.getAttribute('data-visible') !== "false";
                    if(contentVal.trim()){
                        newNotes.push({
                            date: dateVal || new Date().toISOString().split('T')[0],
                            content: contentVal,
                            visible: visibleVal
                        });
                    }
                }
                return newNotes;
            }

            // カスタムデータ更新: カスタムデータ情報を更新
            function updateCustomData(account, changes) {
                const customDataContainer = document.getElementById('edit-custom-data-container');
                const customDataItems = customDataContainer.getElementsByClassName('edit-custom-data-item');
                let newCustomData = [];
                for (const item of customDataItems) {
                    if (newCustomData.length >= 64) {
                        showNotification('カスタムデータの上限に達しました。');
                        break;
                    }
                    const labelVal = item.querySelector('.edit-custom-data-label').value;
                    const valueVal = item.querySelector('.edit-custom-data-value').value;
                    const existingData = account.customData.find(data => data.label === labelVal);
                    if (existingData && existingData.value !== valueVal) {
                        changes.push(`${labelVal}を「${existingData.value}」から「${valueVal}」に変更しました`);
                    }
                    if(labelVal.trim() && valueVal.trim()){
                        newCustomData.push({
                            id: generateRandomId(),
                            label: labelVal,
                            value: valueVal
                        });
                    }
                }
                return newCustomData;
            }
            
            // JSONエクスポート: アカウントデータをJSON形式でエクスポート
            exportJsonBtn.addEventListener('click', () => {
                const dataToExport = {
                    accounts: accounts,
                    exportDate: new Date().toISOString(),
                    exportVersion: "v2.1.0"
                };
                const jsonString = JSON.stringify(dataToExport, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `password-manager-export-${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(a);
                a.click();
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 0);
                showNotification('JSONファイルをエクスポートしました');
            });
            
            // デフォルトの個人情報を入力
            document.getElementById('fill-default-personal-add').addEventListener('click', () => {
                fillDefaultPersonalInfo('new');
            });
            
            // 備考を追加
            document.getElementById('add-edit-note').addEventListener('click', function() {
                addEditNote();
            });

            // 新しいカスタムデータを追加
            document.getElementById('add-new-custom-data').addEventListener('click', function() {
                addNewCustomData('new-custom-data-container');
            });

            // 編集用カスタムデータを追加
            document.getElementById('add-edit-custom-data').addEventListener('click', function() {
                addNewCustomData('edit-custom-data-container');
            });

            // カスタムデータのラベル名候補を設定
            const customLabelOptions = document.createElement('datalist');
            customLabelOptions.id = 'custom-label-options';
            const labels = ["ログイン方法", "WEBログインパスワード", "取引パスワード", "支店名", "支店番号", "口座番号", "セキュリティコード", "PINコード", "暗証番号"];
            labels.forEach(label => {
                const option = document.createElement('option');
                option.value = label;
                customLabelOptions.appendChild(option);
            });
            document.body.appendChild(customLabelOptions);
        }

        // モーダルを閉じる処理: モーダルを閉じる際の確認とスタイルリセット
        function handleModalClose(prefix, modal) {
            if (isFormChanged(prefix) && confirm('本当に更新せずに閉じますか？')) {
                modal.style.display = 'none';
            } else if (!isFormChanged(prefix)) {
                modal.style.display = 'none';
            }
            resetFormStyles(prefix);
        }

        // 新しいアカウントを作成: フォームから新しいアカウント情報を取得し、オブジェクトを生成
        function createNewAccount() {
            const newId = generateRandomId();
            const today = new Date().toISOString().split('T')[0];
            
            const newAccount = {
                id: newId,
                account: document.getElementById('new-account').value,
                status: document.getElementById('new-status').value,
                target: document.getElementById('new-target').value,
                email: document.getElementById('new-email').value,
                password: document.getElementById('new-password').value,
                registrationDate: today,
                username: document.getElementById('new-username').value,
                birthdate: document.getElementById('new-birthdate').value,
                gender: document.getElementById('new-gender').value,
                lastName: document.getElementById('new-lastname').value,
                firstName: document.getElementById('new-firstname').value,
                prefecture: document.getElementById('new-prefecture').value,
                country: document.getElementById('new-country').value,
                phone: document.getElementById('new-phone').value,
                postalCode: document.getElementById('new-postalcode').value,
                address: document.getElementById('new-address').value,
                notes: [],
                customData: []
            };
            
            const noteContent = document.getElementById('new-note').value;
            if (noteContent.trim() && newAccount.notes.length < 64) {
                newAccount.notes.push({
                    date: today,
                    content: noteContent,
                    visible: true,
                    isNew: true
                });
            }

            const customDataContainer = document.getElementById('new-custom-data-container');
            const customDataItems = customDataContainer.getElementsByClassName('edit-custom-data-item');
            for (const item of customDataItems) {
                if (newAccount.customData.length >= 64) {
                    showNotification('カスタムデータの上限に達しました。');
                    break;
                }
                const labelVal = item.querySelector('.edit-custom-data-label').value;
                const valueVal = item.querySelector('.edit-custom-data-value').value;
                if(labelVal.trim() && valueVal.trim()){
                    newAccount.customData.push({
                        id: generateRandomId(),
                        label: labelVal,
                        value: valueVal,
                        isNew: true
                    });
                }
            }
            return newAccount;
        }

        // 編集フォームにデータを入力: 編集名義のアカウント情報をフォームに反映
        function populateEditForm(account) {
            const fields = [
                { id: 'edit-account', key: 'account' },
                { id: 'edit-status', key: 'status' },
                { id: 'edit-target', key: 'target' },
                { id: 'edit-email', key: 'email' },
                { id: 'edit-password', key: 'password' },
                { id: 'edit-username', key: 'username' },
                { id: 'edit-birthdate', key: 'birthdate' },
                { id: 'edit-gender', key: 'gender' },
                { id: 'edit-lastname', key: 'lastName' },
                { id: 'edit-firstname', key: 'firstName' },
                { id: 'edit-prefecture', key: 'prefecture' },
                { id: 'edit-country', key: 'country' },
                { id: 'edit-phone', key: 'phone' },
                { id: 'edit-postalcode', key: 'postalCode' },
                { id: 'edit-address', key: 'address' }
            ];

            fields.forEach(field => {
                document.getElementById(field.id).value = account[field.key] || '';
            });

            populateEditNotes(account.notes.map(note => ({ ...note, isNew: false })));
            populateEditCustomData(account.customData.map(data => ({ ...data, isNew: false })));
        }

        // 編集用備考を追加: 新しい備考項目を追加
        function addEditNote() {
            const container = document.getElementById('edit-notes-container');
            if (container.getElementsByClassName('edit-note-item').length >= 64) {
                showNotification('備考の上限に達しました。');
                return;
            }
            const noteItem = createEditNoteItem({ date: new Date().toISOString().split('T')[0], visible: true, isNew: true }, container);
            container.appendChild(noteItem);
        }

        // 新しいカスタムデータを追加: 新しいカスタムデータ項目を追加
        function addNewCustomData(containerId) {
            const container = document.getElementById(containerId);
            if (container.getElementsByClassName('edit-custom-data-item').length >= 64) {
                showNotification('カスタムデータの上限に達しました。');
                return;
            }
            const dataItem = createEditCustomDataItem({ isNew: true }, container);
            container.appendChild(dataItem);
        }

        // デフォルトの個人情報を入力: フォームにデフォルトの個人情報を入力
        function fillDefaultPersonalInfo(prefix) {
            const defaultValues = {
                lastname: "山田",
                firstname: "太郎",
                birthdate: "1990-05-20",
                gender: "男性",
                phone: "090-1234-5678",
                postalcode: "123-4567",
                country: "日本",
                prefecture: "東京都",
                address: "新宿区西新宿1-1-1"
            };

            Object.keys(defaultValues).forEach(key => {
                document.getElementById(`${prefix}-${key}`).value = defaultValues[key];
            });

            const detailsEl = document.getElementById(`${prefix}-details-personal`);
            if (detailsEl) {
                detailsEl.open = true;
            }
        }

        // 通知を表示: ユーザーに通知を表示
        function showNotification(message) {
            domElements.copyNotification.textContent = message;
            domElements.copyNotification.classList.add('show');
            setTimeout(() => {
                domElements.copyNotification.classList.remove('show');
            }, 2000);
        }
        
        // ランダムなIDを生成する関数: ユニークなIDを生成
        function generateRandomId() {
            const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
            let id = '';
            for (let i = 0; i < 8; i++) {
                id += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            // IDがユニークであることを確認
            while (accounts.some(account => account.id === id) || accounts.some(account => account.customData.some(data => data.id === id))) {
                id = '';
                for (let i = 0; i < 8; i++) {
                    id += chars.charAt(Math.floor(Math.random() * chars.length));
                }
            }
            return id;
        }

        // 初期化処理: ページの初期設定を行う
        function init() {
            setupFilterOptions();
            setupAccountManagement();
            domElements.searchAccount.addEventListener('input', filterData);
            domElements.filterStatus.addEventListener('change', filterData);
            domElements.filterTarget.addEventListener('change', filterData);
            domElements.filterEmail.addEventListener('change', filterData);
            domElements.resetFiltersBtn.addEventListener('click', resetFilters);
            filterData();
        }
        
        // 変更を追跡: フォームの変更を追跡
        function trackChanges(prefix) {
            const formElements = document.querySelectorAll(`#${prefix}-account-form input, #${prefix}-account-form select, #${prefix}-account-form textarea`);
            formElements.forEach(element => {
                element.addEventListener('input', () => {
                    element.classList.add('highlighted');
                });
            });
        }

        // フォームが変更されたか確認: フォームに変更があるかを確認
        function isFormChanged(prefix) {
            const formElements = document.querySelectorAll(`#${prefix}-account-form input, #${prefix}-account-form select, #${prefix}-account-form textarea`);
            return Array.from(formElements).some(element => element.classList.contains('highlighted'));
        }

        // フォームスタイルをリセット: フォームのスタイルを初期状態に戻す
        function resetFormStyles(prefix) {
            const formElements = document.querySelectorAll(`#${prefix}-account-form input, #${prefix}-account-form select, #${prefix}-account-form textarea`);
            formElements.forEach(element => {
                element.classList.remove('highlighted');
            });
        }
        
        // 初期化関数を呼び出し
        init();
    </script>
</body>
</html>